---
title:    "C: 向标准错误输出写入"
keywords: ["C"]
editURL:  "https://github.com/dogweather/forkful/blob/master/content/zh/c/writing-to-standard-error.md"
---

{{< edit_this_page >}}

## 为什么

许多程序员都熟悉使用标准输出来打印信息，但是有时候，我们也需要将信息打印到标准错误（standard error，也称为stderr）流中。一般来说，标准错误流用于输出程序运行中的错误信息，而不是正常的程序输出。

为什么我们需要使用标准错误流？这有几个原因。首先，标准输出和标准错误流在大型程序中可以同时使用，从而允许程序员更方便地在不同的地方输出信息。其次，当我们使用管道（piping）命令来连接程序时，标准输出和标准错误流是分别处理的，这样能够更好地控制输出信息。因此，了解如何写入标准错误流对于程序员来说是很重要的。

## 如何做

在C语言中，我们可以使用fprintf函数来将信息写入标准错误流。它的原型如下：

```C
int fprintf(FILE *stream, const char *format, ...);
```

其中，stream参数指定了要输出到的流，我们需要使用stderr来指定标准错误流。format参数是一个字符串，可以使用类似于printf函数的格式化字符串来指定要输出的内容。最后的省略号表示我们可以传入多个参数，用来填充格式化字符串中的占位符。

让我们来看一个简单的例子：

```C
#include <stdio.h>

int main() {
    int num = 100;
    fprintf(stderr, "这里有一个数字：%d\n", num);
    return 0;
}
```

上面的程序将输出以下信息到标准错误流中：

```
这里有一个数字：100
```

需要注意的是，标准错误流的输出不会打断程序的正常运行，也就是说即使我们将信息输出到标准错误流中，程序也会继续执行，直到结束。因此，它比标准输出更适合用来输出错误信息。

## 深度探讨

在深入使用标准错误流之前，我们需要了解一些有关流的基本知识。流是用来把数据从程序传输到其他设备中的抽象概念，它可以表示为输入流（input stream）或输出流（output stream）。标准错误流属于标准错误设备，通常与标准输出设备是分开的。

如果我们想要在程序中同时使用标准输出和标准错误流，需要做一些额外的设置，比如使用`dup2()`函数来建立标准输出和标准错误流的映射关系。同时，我们也可以使用`stderr`宏来表示标准错误流，这样可以提高代码的可读性。

除了使用fprintf函数，我们还可以使用fputs函数来将字符串直接输出到标准错误流中。此外，如果需要在标准错误流中输出一段较长的信息，我们还可以使用多行注释来实现，如下面的例子所示：

```C
/* 输出一段较长的错误信息到标准错误流中 */
fprintf(stderr, "这是一段\n多行\n错误信息\n");
```

## 另请参阅

如果想要了解更多关于标准错误流的知识，可以查看下面这些链接：

- [C程序中的标准错误流详解](https://www.runoob.com/cprogramming/c-standard-error.html)
- [Linux命令行中的标准输出和标准错误](https://linux.cn/article-10183-1.html)
- [标准错误流的使用场景](https://stackoverflow.com/questions/2342826/when-to-use-stderr-instead-of-stdout-in-c)