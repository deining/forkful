---
changelog:
- 2024-01-29, gpt-4-0125-preview, translated from English
date: 2024-01-29 00:02:42.000133-07:00
description: "\u041A\u0430\u043A \u044D\u0442\u043E \u0434\u0435\u043B\u0430\u0442\
  \u044C: \u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0432\u043E\u0437\u044C\u043C\
  \u0435\u043C \u043F\u0440\u043E\u0441\u0442\u0443\u044E \u0444\u0443\u043D\u043A\
  \u0446\u0438\u044E Lua \u0438 \u0440\u0435\u0444\u0430\u043A\u0442\u043E\u0440\u0438\
  \u043C \u0435\u0451. \u041C\u044B \u043D\u0430\u0447\u043D\u0435\u043C \u0441 \u0444\
  \u0443\u043D\u043A\u0446\u0438\u0438, \u043A\u043E\u0442\u043E\u0440\u0430\u044F\
  \ \u0432\u044B\u0447\u0438\u0441\u043B\u044F\u0435\u0442 \u0441\u0443\u043C\u043C\
  \u0443 \u0447\u0438\u0441\u0435\u043B \u0432 \u0441\u043F\u0438\u0441\u043A\u0435\
  , \u043D\u043E \u043D\u0430\u043F\u0438\u0441\u0430\u043D\u0430 \u0431\u0435\u0437\
  \ \u043E\u0441\u043E\u0431\u044B\u0445\u2026"
lastmod: '2024-03-13T22:44:45.304058-06:00'
model: gpt-4-0125-preview
summary: "\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0432\u043E\u0437\u044C\u043C\
  \u0435\u043C \u043F\u0440\u043E\u0441\u0442\u0443\u044E \u0444\u0443\u043D\u043A\
  \u0446\u0438\u044E Lua \u0438 \u0440\u0435\u0444\u0430\u043A\u0442\u043E\u0440\u0438\
  \u043C \u0435\u0451."
title: "\u0420\u0435\u0444\u0430\u043A\u0442\u043E\u0440\u0438\u043D\u0433"
weight: 19
---

## Как это делать:
Давайте возьмем простую функцию Lua и рефакторим её. Мы начнем с функции, которая вычисляет сумму чисел в списке, но написана без особых размышлений об эффективности или ясности:

```Lua
function sumList(numbers)
    local result = 0
    for i=1, #numbers do
        for j=1, #numbers do
            if i == j then
                result = result + numbers[i]
            end
        end
    end
    return result
end

print(sumList({1, 2, 3, 4})) -- Выводит: 10
```

Рефакторинг до более эффективной и читаемой версии:
```Lua
function sumListRefactored(numbers)
    local result = 0
    for _, value in ipairs(numbers) do
        result = result + value
    end
    return result
end

print(sumListRefactored({1, 2, 3, 4})) -- По-прежнему выводит: 10
```

Рефакторинг версии избавляется от избыточного внутреннего цикла, используя `ipairs` для чистой итерации по списку.

## Глубокое погружение
Исторически рефакторинг появился из программного сообщества Smalltalk в конце 80-ых и был популяризирован книгой Мартина Фаулера "Рефакторинг: Улучшение проектирования существующего кода". В Lua рефакторинг часто включает в себя упрощение сложных условий, разбиение больших функций на меньшие и оптимизацию использования таблиц для улучшения производительности.

Рефакторинг в Lua имеет свои особенности; динамичная природа Lua и гибкая типизация могут сделать некоторые рефакторинги, такие как переименование переменных или изменение сигнатур функций, более рискованными, если они не выполняются осторожно. Инструменты для статического анализа кода (например, `luacheck`) могут снизить такие риски. Альтернативы включают разработку, управляемую тестированием (TDD), где код непрерывно рефакторится как неотъемлемая часть процесса разработки, в отличие от отдельной фазы рефакторинга.

## Смотрите также
- "Programming in Lua" Роберто Иерусалимщика для лучших практик и примеров.
- "Рефакторинг: Улучшение проектирования существующего кода" Мартина Фаулера для принципов, применимых в разных языках.
- Директория LuaRocks (https://luarocks.org/) для инструментов и модулей, направленных на поддержание и рефакторинг кода Lua.
